# SPRING-UNIT-TEST

This module contains all dependencies needed to create unit tests and classes with generic tools to reduce and standardize the testing.

## Technologies to unit testing

*   All our unit test must extend from SpringtTestParent.java

*   junit4. Base to unit tests. More info at 

	<http://www.mkyong.com/tutorials/junit-tutorials/>
	
	<https://zeroturnaround.com/rebellabs/junit-cheat-sheet/>
	
Please see the Assertions 
	
	<https://github.com/junit-team/junit4/wiki/assertions>

*   junit-dataprovider. To create parametrized tests.

	<https://github.com/TNG/junit-dataprovider/wiki/Getting-started#usage>
	
Please see @DataProvider with "format" option and @UseDataProvider

*   jmockit. Library to create mocks. More info at 

	<http://jmockit.org/tutorial.html>
	
Please see Expectations with "minTimes", "result". To test spring beans please see @Tested, @Injectable and @Mocked. 

	<http://jmockit.github.io/tutorial/Mocking.html#expectation>
	
Please see any objects in Expectations

	<http://jmockit.github.io/api1x/mockit/VerificationsInOrder.html>
	
*   podam. Library to create. More info at 

	<https://devopsfolks.github.io/podam/>
	
Please see our SpringtTestParent.java with podamFactory,podamFactorySlowly

	podamFactory. It is very fast but use one instance for type.
	
	podamFactorySlowly. If you need all instances with diffs, but  is very slowly.
	
Please see manufacturePojo,manufacturePojoWithFullData,populatePojo
	
*   pitest. Optional use.

    PIT is a state of the art mutation testing system, providing gold standard 
    test coverage for Java and the jvm. It's fast, scalable and 
    integrates with modern test and build tooling. 
    
    Add plugin pitest-maven to spring-parent/pom.xml .
    To show information about execution, see each target/pit-reports/ 
    To execute this plugin has two options
    - mvn org.pitest:pitest-maven:mutationCoverage
    - mvn clean test org.pitest:pitest-maven:mutationCoverage
    
    More information [pitest](pitest.org)
    
## Recomendations writing unit test

### Fill objects: 
   
Typically you need to create a lot of various objects with various states in your tests. But you don’t always have appropriate constructors, and probably don’t want to have too many constructors. For this has two "right" options:
   
If want build object with all random attributes value,best option is use Podam. 
   
If want try different case without all attributes or different custom values, best option is use lambdas.
   
Such tests are pretty well readable. Example:

First, add constructor like this at class to use lambdas

            public Body(Consumer<Body> bodyConsumer) {
            		    bodyConsumer.accept(this);
            	}

            Body body  = new Body(bod -> {
                    bod.setHead(new Head());
                    bod.setArms(arms);
                })

Some full example [constructor lambdas](https://asolntsev.github.io/en/2016/04/11/unit-tests-with-java8/).

As a recomendation, when  use this lambdas, can use [junit dataprovider](https://github.com/TNG/junit-dataprovider)
            
### @Rule 

This junit4 annotation apply rules to expected unit test result. 

Exist different rule to use, also can create a custom rule, just need class to implement the TestRule.

More information [here](https://github.com/junit-team/junit4/wiki/rules)
        
### Parameterized test with junit DataProvider
      
To generate simple unit test for multiple cases. 

Junit DataProvider generate array object , but automatically asign values to method parameters
      
### More details and tutorials : 

[7 Tips for Writing Better Unit Tests in Java](https://dzone.com/articles/7-tips-for-writing-better-unit-tests-in-java)

[Unit test with junit 4 & 5](http://www.vogella.com/tutorials/JUnit/article.html)
  
## We are going to test...

We are going to test methods with logic and conditions. All our unit tests need asserts. We do not coverage tests we testing our logic conditions. To test complete actions we do integration tests. 

### In third clients

We test tool/util classes with methods with parse and treatment of the requests/responses.

### In adapters

We test converter/util classes between third model and spring model.

### Other classes

If the other classes only have one logic way we do not test this. 

### You do not test this, please
        
* Our Model classes. We use lombok, please remove your tests about getters,setters,toString and other autogenerated methods. Lombok have good tests in their code.

* Autogenerated classes with jaxb or similar. If the classes are autogenerated, please do not test.

* Methods that only call to other classes and return the result. Typically, @RestControllers, for example.

### Allure annotations

We use Allure to view pretty reports in junit. 

Allure add some annotations and we going to use some

 * @Feature to indicate the feature relation test.
 
 * @Issue used in hotfixes to indicate the hotfix.
 
 * @Description if the name of test are very big, please add a good description.

